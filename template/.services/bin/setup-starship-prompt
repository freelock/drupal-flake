#!/usr/bin/env bash
# Script to help set up starship prompt integration

echo "ðŸŒŸ Setting up Starship prompt integration for process-compose status"
echo ""

STARSHIP_CONFIG="$HOME/.config/starship.toml"

# Check if starship config exists
if [ ! -f "$STARSHIP_CONFIG" ]; then
    echo "Creating starship config at $STARSHIP_CONFIG"
    mkdir -p "$(dirname "$STARSHIP_CONFIG")"
    touch "$STARSHIP_CONFIG"
fi

# Check if our custom module already exists
if grep -q "\[custom\.project_name\]" "$STARSHIP_CONFIG"; then
    echo "âœ… PROJECT_NAME custom module already exists in starship config"
else
    echo "ðŸ“ Adding PROJECT_NAME custom module to starship config..."
    
    cat >> "$STARSHIP_CONFIG" << 'EOF'

# Add custom modules to format if not already present
format = "$all$custom$character"

# PROJECT_NAME indicator  
[custom.project_name]
command = '[ -n "$PROJECT_NAME" ] && echo "$PROJECT_NAME"'
format = "ðŸ’§â„ï¸ [$output]($style) "
style = "bold green"
EOF
    
    echo "âœ… Added PROJECT_NAME module to $STARSHIP_CONFIG"
fi

echo ""
echo "ðŸŽ¯ Setup complete! Your prompt will now show:"
echo "   ðŸ’§â„ï¸ project-name  when in nix development environment"
echo "   (nothing)        when outside nix development environment"
echo ""
echo "ðŸ’¡ Usage:"
echo "   start-detached   - Start development environment in background"
echo "   stop-detached    - Stop development environment"
echo "   process-compose attach --project-name PROJECT_NAME - Attach to running TUI"
echo ""
echo "ðŸ”„ Restart your shell or run 'exec fish' to see the changes"