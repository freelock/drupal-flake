#!/usr/bin/env bash
# Script to help set up starship prompt integration

echo "🌟 Setting up Starship prompt integration for process-compose status"
echo ""

STARSHIP_CONFIG="$HOME/.config/starship.toml"

# Check if starship config exists
if [ ! -f "$STARSHIP_CONFIG" ]; then
    echo "Creating starship config at $STARSHIP_CONFIG"
    mkdir -p "$(dirname "$STARSHIP_CONFIG")"
    touch "$STARSHIP_CONFIG"
fi

# Check if our custom module already exists
if grep -q "\[custom\.process_compose\]" "$STARSHIP_CONFIG"; then
    echo "✅ process_compose custom module already exists in starship config"
else
    echo "📝 Adding process_compose custom module to starship config..."
    
    cat >> "$STARSHIP_CONFIG" << 'EOF'

# Process-compose status indicator (optimized shell)
[custom.process_compose]
command = "starship-process-compose"
when = true
shell = ["sh", "--norc"]
format = "[$output]($style) "
style = "bold green"
EOF
    
    echo "✅ Added process_compose module to $STARSHIP_CONFIG"
fi

echo ""
echo "🎯 Setup complete! Your prompt will now show:"
echo "   💧❄️ project-name  when process-compose is running for this project"
echo "   (nothing)         when process-compose is not running"
echo ""
echo "💡 Usage:"
echo "   start-detached    - Start development environment in background"
echo "   pc-attach         - Attach to running process-compose TUI"
echo "   pc-status         - Check if process-compose is running"
echo ""
echo "🔄 Restart your shell or run 'exec fish' to see the changes"